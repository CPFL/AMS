{
  "initial_state": "StartProcessing",
  "variables": {
    "kvs_client": null,
    "pubsub_client": null,
    "maps_client": null,
    "target_traffic_signal": null,
    "target_traffic_signal_controller": null
  },
  "transitions": [
    {
      "event": null,
      "from": "StartProcessing",
      "to": "WaitingEvent",
      "hooks": null,
      "conditions": null
    },
    {
      "event": null,
      "from": "WaitingEvent",
      "to": "UpdatingSchedule",
      "hooks": null,
      "conditions": [
        {
          "function": "traffic_signal_cycle_exists",
          "args": ["kvs_client", "target_traffic_signal"]
        },
        {
          "function": "schedule_close_to_the_end",
          "args": ["kvs_client", "target_traffic_signal"]
        }
      ]
    },
    {
      "event": null,
      "from": "UpdatingSchedule",
      "to": "WaitingEvent",
      "hooks": [
        {
          "function": "remove_old_traffic_signal_event_from_schedule",
          "args": ["kvs_client", "target_traffic_signal"]
        },
        {
          "function": "append_traffic_signal_event_to_schedule_from_cycle",
          "args": ["kvs_client", "target_traffic_signal"]
        }
      ],
      "conditions": [
        {
          "function": "schedule_close_to_the_end",
          "args": ["kvs_client", "target_traffic_signal"],
          "not": true
        }
      ]
    },
    {
      "event": null,
      "from": "WaitingEvent",
      "to": "CheckingSchedule",
      "hooks": null,
      "conditions": [
        {
          "function": "received_schedule_exists",
          "args": ["kvs_client", "target_traffic_signal"]
        }
      ]
    },
    {
      "event": null,
      "from": "CheckingSchedule",
      "to": "ReplacingSchedule",
      "hooks": null,
      "conditions": [
        {
          "function": "traffic_signal_schedule_replaceable",
          "args": ["kvs_client", "target_traffic_signal"]
        }
      ]
    },
    {
      "event": null,
      "from": "CheckingSchedule",
      "to": "ReplacingScheduleFailed",
      "hooks": null,
      "conditions": [
        {
          "function": "traffic_signal_schedule_replaceable",
          "args": ["kvs_client", "target_traffic_signal"],
          "not": true
        }
      ]
    },
    {
      "event": null,
      "from": "CheckingSchedule",
      "to": "ReplacingScheduleFailed",
      "hooks": null,
      "conditions": [
        {
          "function": "traffic_signal_state_timeout",
          "args": ["kvs_client", "target_traffic_signal"]
        }
      ]
    },
    {
      "event": null,
      "from": "ReplacingSchedule",
      "to": "ReplacingScheduleSucceeded",
      "hooks": [
        {
          "function": "replace_schedule",
          "args": ["kvs_client", "target_traffic_signal"]
        }
      ],
      "conditions": [
        {
          "function": "schedule_replaced",
          "args": ["kvs_client", "target_traffic_signal"]
        }
      ]
    },
    {
      "event": null,
      "from": "ReplacingSchedule",
      "to": "ReplacingScheduleFailed",
      "hooks": null,
      "conditions": [
        {
          "function": "traffic_signal_state_timeout",
          "args": ["kvs_client", "target_traffic_signal"]
        }
      ]
    },
    {
      "event": "return_to_wait_event",
      "from": "ReplacingScheduleSucceeded",
      "to": "WaitingEvent",
      "hooks": null,
      "conditions": [
      ]
    },
    {
      "event": null,
      "from": "ReplacingScheduleSucceeded",
      "to": "WaitingEvent",
      "hooks": null,
      "conditions": [
        {
          "function": "traffic_signal_state_timeout",
          "args": ["kvs_client", "target_traffic_signal"]
        }
      ]
    },
    {
      "event": "return_to_wait_event",
      "from": "ReplacingScheduleFailed",
      "to": "WaitingEvent",
      "hooks": [
        {
          "function": "initialize_received_schedule",
          "args": ["kvs_client", "target_traffic_signal"]
        }
      ],
      "conditions": [
        {
          "function": "received_schedule_initialized",
          "args": ["kvs_client", "target_traffic_signal"]
        }
      ]
    },
    {
      "event": null,
      "from": "ReplacingScheduleFailed",
      "to": "WaitingEvent",
      "hooks": [
        {
          "function": "initialize_received_schedule",
          "args": ["kvs_client", "target_traffic_signal"]
        }
      ],
      "conditions": [
        {
          "function": "traffic_signal_state_timeout",
          "args": ["kvs_client", "target_traffic_signal"]
        },
        {
          "function": "received_schedule_initialized",
          "args": ["kvs_client", "target_traffic_signal"]
        }
      ]
    },
    {
      "event": null,
      "from": "WaitingEvent",
      "to": "ChangingLightColor",
      "hooks": null,
      "conditions": [
        {
          "function": "schedule_close_to_the_end",
          "args": ["kvs_client", "target_traffic_signal"],
          "not": true
        },
        {
          "function": "event_close_to_the_end",
          "args": ["kvs_client", "target_traffic_signal"]
        }
      ]
    },
    {
      "event": null,
      "from": "ChangingLightColor",
      "to": "ChangingNextLightColor",
      "hooks": [
        {
          "function": "update_traffic_signal_light_color",
          "args": ["kvs_client", "target_traffic_signal"]
        }
      ],
      "conditions": [
        {
          "function": "traffic_signal_light_color_updated",
          "args": ["kvs_client", "target_traffic_signal"]
        }
      ]
    },
    {
      "event": null,
      "from": "ChangingNextLightColor",
      "to": "PublishingLightColor",
      "hooks": [
        {
          "function": "update_traffic_signal_next_light_color",
          "args": ["kvs_client", "target_traffic_signal"]
        }
      ],
      "conditions": [
        {
          "function": "traffic_signal_next_light_color_updated",
          "args": ["kvs_client", "target_traffic_signal"]
        }
      ]
    },
    {
      "event": null,
      "from": "PublishingLightColor",
      "to": "WaitingEvent",
      "hooks": [
        {
          "function": "publish_traffic_signal_status",
          "args": ["pubsub_client", "kvs_client", "target_traffic_signal", "target_traffic_signal_controller"]
        }
      ],
      "conditions": null
    },
    {
      "event": "end_node",
      "from": "WaitingEvent",
      "to": "EndProcessing",
      "hooks": [
        {
          "function": "publish_traffic_signal_status",
          "args": ["pubsub_client", "kvs_client", "target_traffic_signal", "target_traffic_signal_controller"]
        }
      ],
      "conditions": null
    },
    {
      "event": null,
      "from": "EndProcessing",
      "to": "End",
      "hooks": null,
      "conditions": [
        {
          "function": "traffic_signal_state_timeout",
          "args": ["kvs_client", "target_traffic_signal"]
        }
      ]
    }
  ]
}